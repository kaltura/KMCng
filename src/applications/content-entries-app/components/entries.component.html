<div class="kEntries grid-noGutter kUseKMCngIcons">

    <div #entriesTableHolder class="kEntriesHolder kContent grid-column-noGutter">
        <div class="kEntriesTableFilters grid col-12">
            <span *ngIf="(_entriesStore.entries$ | async)?.totalCount">{{(_entriesStore.entries$ | async)?.totalCount}} {{'applications.content.entries.entries' | translate}}</span>

            <div [class.kHidden]="!_selectedEntries.length" class="kBulkOperations">
                <span class="kSelectedEntriesLabel">â€¢ {{_selectedEntries.length}} {{'applications.content.entries.selected' | translate}}</span>
                <button pButton icon="kIcontrash" class="kButtonDanger kBulkDeleteBtn"></button>
                <button class="kButtonDefault kBulkActionsBtn" icon="kIcondropdown_arrow_bottom" iconPos="right" [disabled]="!_selectedEntries.length" pButton label="{{'applications.content.entries.bulkActions' | translate}}" (click)="menu.toggle($event)"></button>
                <a class="kBulkCancel" (click)="clearSelection()">{{'applications.content.entries.cancel' | translate}}</a>
            </div>
            <div [class.kHidden]="_selectedEntries.length" class="kFilters">
                    <input type="text" pInputText class="kSearchInput"
                           [(ngModel)]="_filter.freetextSearch"
                           (keyup.enter)="onFreetextChanged()"
                           placeholder="{{'applications.content.entries.searchEntries' | translate}}">
                <div #categoriesFilterBtn class="kCategoriesFilter"><i class="kIconfolder"></i><span>{{'applications.content.entries.filterCategories' | translate}}</span><i class="kIcondropdown_arrow_bottom dropdown"></i></div>
                <div #refineBtn class="kRefine"><i class="kIconfilter"></i><span>{{'applications.content.entries.refine' | translate}}</span><i class="kIcondropdown_arrow_bottom dropdown"></i></div>
            </div>
            <button pButton class="kButtonDefault kRefreshBtn small" type="text" (click)="_reload()" icon="kIconrefresh" title="{{'applications.content.entries.refresh' | translate}}"></button>
        </div>

        <kTags [title]="'applications.content.filters.activeFilters' | translate" [data]="(this._entriesStore.query$ | async)?.filters" [labelField]="'label'" [tooltipField]="'tooltip'" (onTagRemove)="removeTag($event)" (onRemoveAll)="removeAllTags()">
			<template let-item="item">
				<div class="kTagContent" pTooltip="{{item.tooltip}}" tooltipPosition="top">
					<span class="kTagLabel">{{item.label}}</span>
					<i *ngIf="item.showRemove" class="kTagRemove kIconclose_small" (click)="removeTag(item.data)"></i>
				</div>
			</template>
		</kTags>

        <kEntriesTable class="kEntriesTable grid-column-noGutter col"
                       [entries]="(_entriesStore.entries$ | async)?.items" [filter]="_filter"
                       [(selectedEntries)]="_selectedEntries" (sortChanged)="onSortChanged($event)"
                       (actionSelected)="onActionSelected($event)"></kEntriesTable>

        <div class="kEntriesTableFooter col-12" #footer>

            <p-paginator [rows]="_filter.pageSize" (onPageChange)="onPaginationChanged($event)"
                         [first]="_filter.pageIndex * _filter.pageSize"
                         [totalRecords]="(_entriesStore.entries$ | async)?.totalCount | kMaxEntries"
                         [rowsPerPageOptions]="[25,50,75,100]"></p-paginator>
            <span class="kPaginatorShowRowsLabel">{{'applications.content.paginator.showRows' | translate}}</span>
        </div>
    </div>
    <p-tieredMenu #menu [model]="_bulkActionsMenu" [popup]="true" [styleClass]="menu"></p-tieredMenu>
</div>

<!-- popup widgets section -->
<kPopupWidget #categoriesFilterPopup [appendTo]="entriesTableHolder" [popupWidth]="400" [popupHeight]="500" [closeBtn]="false" [targetRef]="categoriesFilterBtn" [targetOffset]="{'x':-10, 'y': -21}">
    <kCategoriesFilter [parentPopupWidget]="categoriesFilterPopup"></kCategoriesFilter>
</kPopupWidget>

<kPopupWidget #refinePopup [appendTo]="entriesTableHolder" [popupWidth]="400" [popupHeight]="500" [closeBtn]="false" [targetRef]="refineBtn" [targetOffset]="{'x':-220, 'y': -22}">
    <kEntriesAdditionalFilter [parentPopupWidget]="refinePopup" ></kEntriesAdditionalFilter>
</kPopupWidget>

<kPopupWidget #releaseNotes [popupWidth]="705" [popupHeight]="540" [modal]="true" [closeBtn]="true" (onClose)="_removeReleaseNotes()">
    <kReleaseNotes (onChange)="_toggleReleaseNotes($event)"></kReleaseNotes>
</kPopupWidget>
