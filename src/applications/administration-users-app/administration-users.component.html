<k-area-blocker kFillHeight [showLoader]="(usersStore.state$ | async)?.loading || loading" [message]="blockerMessage">
  <div class="kUsers kOverrideFAIcons">
    <div class="kContent kUsersWrapper">
      <div class="kUsersHeader">
        <div class="kUsersTitle">{{'applications.content.users.usersTitle' | translate}}</div>
        <div class="kUsersExplanatory">{{'applications.content.users.usersExplanatory' | translate}}</div>
        <div class="kUsersStatus">
          {{usersInfo}}
        </div>
        <div class="kUsersNeedMore">
          {{'applications.content.users.moreUsers' | translate}}
          <a class="kClickHere" (click)="upgradeAccount()">{{'applications.content.users.clickHere' | translate}}</a>
          {{'applications.content.users.usersUpgrade' | translate}}
        </div>
      </div>
      <div class="kUsersHolder kContent">
        <div class="kUsersHead">
          <button
            pButton
            type="button"
            label="{{'applications.content.users.addUser' | translate}}"
            class="kButtonBranded kAddUserBtn"
            [disabled]="usersTotalCount === _partnerInfo.adminLoginUsersQuota"
            (click)="addUser()"></button>
          <span class="kUserAmount" *ngIf="usersAmount">
            {{usersAmount}}
          </span>
        </div>
        <kUsersTable
          class="kUsersTable"
          [users]="(usersStore.usersData$ | async)?.users.items"
          [partnerInfo]="(usersStore.usersData$ | async)?.partnerInfo"
          (editUser)="onEditUser($event)"
          (toggleUserStatus)="onToggleUserStatus($event)"
          (deleteUser)="onDeleteUser($event)"></kUsersTable>
        <div class="kUsersTableFooter" #footer *ngIf="(usersStore.usersData$ | async)?.users.totalCount">
          <p-paginator
            [rows]="_filter.pageSize"
            [first]="_filter.pageIndex * _filter.pageSize"
            [rowsPerPageOptions]="[25,50,100,250,500]"
            [totalRecords]="(usersStore.usersData$ | async)?.users.totalCount"
            (onPageChange)="onPaginationChanged($event)"></p-paginator>
          <span class="kPaginatorShowRowsLabel">{{'applications.content.paginator.showRows' | translate}}</span>
        </div>
      </div>
    </div>
  </div>

  <kPopupWidget #editUserPopup [popupWidth]="500" [popupHeight]="663" [modal]="true">
    <div class="kFloater kOverrideFAIcons">
      <div class="kHeader">
        <div class="kTitle">{{popupTitle}}</div>
      </div>

      <div class="kContainer">
        <form [formGroup]="userForm" novalidate>
          <div class="kCaption">{{'applications.content.users.personalDetails' | translate}}</div>
          <div class="kRow kValign">
            <span class="kLabel">{{'applications.content.users.loginEmailAddress' | translate}}</span>
            <div class="kControl">
              <input #email formControlName="email" type="text" pInputText />
              <div [ngClass]="{'hidden': !userForm.controls['email'].dirty}">
                <div class="invalid" [ngClass]="{'hidden': email.value !== ''}">{{'applications.content.users.required' | translate}}</div>
                <div class="invalid" [ngClass]="{'hidden': userForm.controls['email'].valid}">{{'applications.content.users.emailFormat' | translate}}</div>
              </div>
            </div>
          </div>
          <div class="kRow kValign">
            <span class="kLabel">{{'applications.content.users.firstName' | translate}}</span>
            <div class="kControl">
              <input #firstName formControlName="firstName" type="text" pInputText />
              <div class="invalid" [ngClass]="{'hidden': firstName.value !== '' || !userForm.controls['firstName'].dirty}">{{'applications.content.users.required' | translate}}</div>
            </div>
          </div>
          <div class="kRow kValign">
            <span class="kLabel">{{'applications.content.users.lastName' | translate}}</span>
            <div class="kControl">
              <input #lastName formControlName="lastName" type="text" pInputText />
              <div class="invalid" [ngClass]="{'hidden': lastName.value !== '' || !userForm.controls['lastName'].dirty}">{{'applications.content.users.required' | translate}}</div>
            </div>
          </div>
          <div class="kCaption">{{'applications.content.users.accountSpecificDetails' | translate}}</div>
          <div class="kRow kValign">
            <span class="kLabel">{{'applications.content.users.publisherUserId' | translate}}</span>
            <div class="kControl">
              <input formControlName="id" type="text" pInputText />
            </div>
          </div>
          <div class="kRow kValign">
            <span class="kLabel">{{'applications.content.users.userRole' | translate}}</span>
            <div class="kControl">
              <p-dropdown [options]="rolesList" (onChange)="getRoleDescription($event)" formControlName="roleIds" styleClass="rolesList" [autoWidth]="false"></p-dropdown>
            </div>
          </div>
          <div class="kRow kValign">
            <span class="kLabel">{{'applications.content.users.userRoleDescription' | translate}}</span>
            <div class="kControl extraMargin">
              {{selectedRole}}
            </div>
          </div>
        </form>
      </div>

      <div class="kFooter">
        <button type="button" class="kButtonBranded"
                [disabled]="!userForm.dirty" pButton
                label="{{'applications.content.users.save' | translate}}"
                (click)="saveUser()"></button>
      </div>
    </div>
  </kPopupWidget>
</k-area-blocker>
